import{m as b,g as J,a as r,q as K,z as Q,s as E,w as H,c as a,t as v,b as s,G as ss,n as C,H as P,F as ts,B as es,x as o,u as V,p as Z,j as ls,o as d,I as j,L,J as os}from"./vendor-vue-BAWZmQqV.js";import{_ as is,s as O}from"./index-Ditb8j84.js";const ns={key:0,class:"detail-container"},as={class:"main-layout"},ds={class:"toolbar"},us={class:"image-wrapper"},rs={class:"panzoom-container"},vs=["src","alt"],cs={class:"filmstrip-container"},fs=["onClick"],ms=["src","onLoad"],ps={key:0,class:"map-section"},hs={class:"sidebar-content"},_s={class:"info-block"},xs={class:"info-list"},gs={class:"row"},bs=["title"],ks={class:"row"},ws={class:"row"},ys={class:"row"},Cs=["title"],Ts={class:"info-block"},Is=["title"],zs={key:0,class:"info-block"},Ms={class:"params-grid"},Ps={class:"param-item"},Ls={class:"p-val"},$s={class:"param-item"},Ds={class:"p-val"},Rs={class:"param-item"},Bs={class:"p-val"},Ss={class:"param-item"},Ys={class:"p-val"},Es={key:1,class:"info-block"},Hs={class:"info-list"},Vs={class:"row"},Zs=["title"],js={class:"row"},Os=["title"],Ws={class:"row"},Xs={class:"row"},As=["title"],Ns={key:2,class:"info-block"},Us={class:"info-list"},Fs={class:"row"},qs={class:"row"},Gs=["title"],Js={class:"row"},Ks=["title"],Qs={class:"row"},st=["title"],tt={key:3,class:"info-block"},et={class:"info-list"},lt={class:"row"},ot={class:"row"},it={class:"row"},nt=["title"],at={__name:"PhotoDetail",setup(dt){const g=J(),T=Q(),I=l=>{if(!l)return"";if(l.startsWith("http"))return l;const t="gc-china",m="vue-photo-wall",i="main";let n=l;n.startsWith("/")&&(n=n.slice(1)),n.startsWith("public/")||(n="public/"+n);const G=n.split("/").map(encodeURIComponent).join("/");return`https://cdn.jsdelivr.net/gh/${t}/${m}@${i}/${G}`},p=b(()=>O.photos||[]),e=b(()=>p.value.find(l=>l.id===g.params.id)),k=b(()=>p.value.findIndex(l=>l.id===g.params.id)),h=b(()=>k.value>0?p.value[k.value-1]:null),_=b(()=>k.value<p.value.length-1?p.value[k.value+1]:null),c=r(!0),$=()=>{c.value=!c.value,setTimeout(()=>{c.value&&u&&u.invalidateSize()},350)};K(()=>{O.initData(),window.addEventListener("keydown",D)});const f=l=>{l&&l!==g.params.id&&T.replace(`/photo/${l}`).catch(()=>{})},w=r(0),y=r(0),D=l=>{l.key==="ArrowLeft"&&h.value&&f(h.value.id),l.key==="ArrowRight"&&_.value&&f(_.value.id),l.key==="Escape"&&T.back(),(l.key==="i"||l.key==="I")&&$()},W=l=>{l.touches.length===1&&(w.value=l.changedTouches[0].screenX)},X=l=>{l.changedTouches.length===1&&(y.value=l.changedTouches[0].screenX,A())},A=()=>{Math.abs(y.value-w.value)>50&&(y.value<w.value-50&&_.value&&f(_.value.id),y.value>w.value+50&&h.value&&f(h.value.id))};E(()=>window.removeEventListener("keydown",D));const z=r(null);let x=null;const N=()=>{x&&(x.dispose(),x=null),z.value&&(x=os(z.value,{maxZoom:5,minZoom:.5,bounds:!0,boundsPadding:.1,onTouch:()=>!1}))},M=r(null);let u=null;const R=()=>{var m,i;if(u&&(u.off(),u.remove(),u=null),!((i=(m=e.value)==null?void 0:m.exif)!=null&&i.gps)||!M.value)return;const{lat:l,lng:t}=e.value.exif.gps;u=L.map(M.value,{zoomControl:!1,attributionControl:!1,scrollWheelZoom:!1,dragging:!1,doubleClickZoom:!1}).setView([l,t],14),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{maxZoom:19}).addTo(u),L.circleMarker([l,t],{color:"#fff",fillColor:"#1890ff",fillOpacity:1,radius:6,weight:2}).addTo(u)},B=r(null),S=r({}),U=()=>{const l=g.params.id,t=S.value[l];t&&B.value&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})};H(()=>g.params.id,l=>{l&&j(()=>{c.value&&R(),N(),U()})},{immediate:!0}),H(c,l=>{l&&j(()=>{R()})}),E(()=>{x&&x.dispose()});const F=()=>T.back(),Y=r(new Set),q=l=>Y.value.add(l);return(l,t)=>{var m;return e.value?(d(),a("div",ns,[s("div",{class:"blur-bg",style:ss({backgroundImage:`url(${I(e.value.url)})`})},null,4),t[31]||(t[31]=s("div",{class:"blur-overlay"},null,-1)),s("div",as,[s("div",{class:"preview-area",onTouchstartPassive:W,onTouchendPassive:X},[s("div",ds,[s("button",{class:C(["icon-btn info-toggle",{active:c.value}]),onClick:$,title:"Toggle Info (i)"},[...t[2]||(t[2]=[s("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"12",cy:"12",r:"10"}),s("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),s("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})],-1)])],2),s("button",{class:"icon-btn close-btn",onClick:F,title:"Close (Esc)"},[...t[3]||(t[3]=[s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),s("div",us,[h.value?(d(),a("button",{key:0,class:"nav-arrow left desktop-only",onClick:t[0]||(t[0]=P(i=>f(h.value.id),["stop"]))},"â€¹ ")):v("",!0),s("div",rs,[s("img",{ref_key:"mainImgRef",ref:z,src:I(e.value.url),alt:e.value.name,class:"main-img"},null,8,vs)]),_.value?(d(),a("button",{key:1,class:"nav-arrow right desktop-only",onClick:t[1]||(t[1]=P(i=>f(_.value.id),["stop"]))},"â€º ")):v("",!0)]),s("div",cs,[s("div",{class:"filmstrip",ref_key:"filmstripRef",ref:B},[(d(!0),a(ts,null,es(p.value,i=>(d(),a("div",{key:i.id,class:C(["thumb-item",{active:i.id===e.value.id}]),ref_for:!0,ref:n=>{n&&(S.value[i.id]=n)},onClick:P(n=>f(i.id),["stop"])},[s("img",{src:I(i.url),loading:"lazy",class:C({visible:Y.value.has(i.id)}),onLoad:n=>q(i.id)},null,42,ms)],10,fs))),128))],512)])],32),s("aside",{class:C(["sidebar",{"sidebar-closed":!c.value}])},[t[30]||(t[30]=s("div",{class:"mobile-handle"},null,-1)),(m=e.value.exif)!=null&&m.gps?(d(),a("div",ps,[s("div",{ref_key:"mapContainer",ref:M,class:"map-view"},null,512),t[4]||(t[4]=s("div",{class:"map-overlay"},null,-1))])):v("",!0),s("div",hs,[s("div",_s,[t[9]||(t[9]=s("h3",{class:"block-title"},"åŸºæœ¬ä¿¡æ¯",-1)),s("dl",xs,[s("div",gs,[t[5]||(t[5]=s("dt",null,"æ–‡ä»¶å",-1)),s("dd",{title:e.value.name},o(e.value.name),9,bs)]),s("div",ks,[t[6]||(t[6]=s("dt",null,"å°ºå¯¸",-1)),s("dd",null,o(e.value.width)+" Ã— "+o(e.value.height),1)]),s("div",ws,[t[7]||(t[7]=s("dt",null,"å¤§å°",-1)),s("dd",null,o(e.value.size),1)]),s("div",ys,[t[8]||(t[8]=s("dt",null,"æ—¶é—´",-1)),s("dd",{title:V(Z)(e.value.date).format("YYYY/MM/DD HH:mm:ss")},o(V(Z)(e.value.date).format("YYYY/MM/DD HH:mm")),9,Cs)])])]),s("div",Ts,[s("div",{class:"album-tag-box",title:e.value.category},[t[10]||(t[10]=s("span",{class:"icon"},"ğŸ“‚",-1)),ls(" "+o(e.value.category),1)],8,Is)]),e.value.exif?(d(),a("div",zs,[t[15]||(t[15]=s("h3",{class:"block-title"},"æ‹æ‘„å‚æ•°",-1)),s("div",Ms,[s("div",Ps,[t[11]||(t[11]=s("span",{class:"p-label"},"ç„¦è·",-1)),s("span",Ls,o(e.value.exif.focal),1)]),s("div",$s,[t[12]||(t[12]=s("span",{class:"p-label"},"å…‰åœˆ",-1)),s("span",Ds,o(e.value.exif.fstop),1)]),s("div",Rs,[t[13]||(t[13]=s("span",{class:"p-label"},"å¿«é—¨",-1)),s("span",Bs,o(e.value.exif.shutter),1)]),s("div",Ss,[t[14]||(t[14]=s("span",{class:"p-label"},"ISO",-1)),s("span",Ys,o(e.value.exif.iso),1)])])])):v("",!0),e.value.exif?(d(),a("div",Es,[t[20]||(t[20]=s("h3",{class:"block-title"},"è®¾å¤‡ä¿¡æ¯",-1)),s("dl",Hs,[s("div",Vs,[t[16]||(t[16]=s("dt",null,"ç›¸æœº",-1)),s("dd",{title:e.value.exif.make+" "+e.value.exif.model},o(e.value.exif.make)+" "+o(e.value.exif.model),9,Zs)]),s("div",js,[t[17]||(t[17]=s("dt",null,"é•œå¤´",-1)),s("dd",{title:e.value.exif.lens},o(e.value.exif.lens),9,Os)]),s("div",Ws,[t[18]||(t[18]=s("dt",null,"35mm ç­‰æ•ˆ",-1)),s("dd",null,o(e.value.exif.focal35),1)]),s("div",Xs,[t[19]||(t[19]=s("dt",null,"è½¯ä»¶",-1)),s("dd",{title:e.value.exif.software},o(e.value.exif.software),9,As)])])])):v("",!0),e.value.exif?(d(),a("div",Ns,[t[25]||(t[25]=s("h3",{class:"block-title"},"æ‹æ‘„æ¨¡å¼",-1)),s("dl",Us,[s("div",Fs,[t[21]||(t[21]=s("dt",null,"ç™½å¹³è¡¡",-1)),s("dd",null,o(e.value.exif.whiteBalance),1)]),s("div",qs,[t[22]||(t[22]=s("dt",null,"æµ‹å…‰æ¨¡å¼",-1)),s("dd",{title:e.value.exif.meteringMode},o(e.value.exif.meteringMode),9,Gs)]),s("div",Js,[t[23]||(t[23]=s("dt",null,"æ›å…‰ç¨‹åº",-1)),s("dd",{title:e.value.exif.exposureProgram},o(e.value.exif.exposureProgram),9,Ks)]),s("div",Qs,[t[24]||(t[24]=s("dt",null,"é—ªå…‰ç¯",-1)),s("dd",{title:e.value.exif.flash},o(e.value.exif.flash),9,st)])])])):v("",!0),e.value.exif?(d(),a("div",tt,[t[29]||(t[29]=s("h3",{class:"block-title"},"æŠ€æœ¯å‚æ•°",-1)),s("dl",et,[s("div",lt,[t[26]||(t[26]=s("dt",null,"äº®åº¦",-1)),s("dd",null,o(e.value.exif.brightness),1)]),s("div",ot,[t[27]||(t[27]=s("dt",null,"æ›å…‰è¡¥å¿",-1)),s("dd",null,o(e.value.exif.exposureBias),1)]),s("div",it,[t[28]||(t[28]=s("dt",null,"ä¼ æ„Ÿæ–¹å¼",-1)),s("dd",{title:e.value.exif.sensingMethod},o(e.value.exif.sensingMethod),9,nt)])])])):v("",!0)])],2)])])):v("",!0)}}},vt=is(at,[["__scopeId","data-v-5f2e705d"]]);export{vt as default};
