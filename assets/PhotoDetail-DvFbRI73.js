import{m as b,g as J,a as i,q as K,A,I as U,w as W,c as n,C as p,b as e,H as G,n as g,z as Q,J as z,j as X,F as ee,y as se,x as t,u as le,p as oe,L as M,o as d,M as te}from"./vendor-vue-C9kWPA4d.js";import{_ as ae,s as Y}from"./index-DqWPLPIy.js";const ie={key:0,class:"detail-container"},ne={class:"main-layout"},de={class:"toolbar"},ue={class:"image-wrapper"},re=["src","poster"],ve={key:2,class:"panzoom-container"},ce=["src","alt"],fe={class:"filmstrip-container"},me=["onClick"],pe=["src","onLoad"],he={key:0,class:"map-section-wrapper"},ye={class:"sidebar-content"},ke={class:"info-block"},be={class:"info-list"},ge={class:"row"},_e=["title"],we={class:"row"},xe={class:"row"},Ce={class:"row"},Te={class:"info-block"},Ie={class:"album-tag-box"},ze={key:0,class:"info-block"},Le={class:"params-grid"},Pe={class:"param-item"},Re={class:"p-val"},De={class:"param-item"},Me={class:"p-val"},Ee={class:"param-item"},Se={class:"p-val"},Ve={class:"param-item"},$e={class:"p-val"},Be={key:1,class:"info-block"},Ze={class:"info-list"},Ae={class:"row"},Xe={class:"row"},Ye=["title"],He={class:"row"},Ne={class:"row"},Oe={__name:"PhotoDetail",setup(je){const h=J(),L=Q(),c=b(()=>Y.photos||[]),o=b(()=>c.value.find(l=>l.id===h.params.id)),_=b(()=>c.value.findIndex(l=>l.id===h.params.id)),f=b(()=>_.value>0?c.value[_.value-1]:null),m=b(()=>_.value<c.value.length-1?c.value[_.value+1]:null),w=i(!1),y=i(null),E=()=>{y.value&&(y.value.paused?(y.value.play(),w.value=!0):(y.value.pause(),w.value=!1))},r=i(!0),P=i(null);let u=null;const R=()=>{var k,a;if(u&&(u.off(),u.remove(),u=null),!((a=(k=o.value)==null?void 0:k.exif)!=null&&a.gps)||!P.value)return;const{lat:l,lng:s}=o.value.exif.gps;u=M.map(P.value,{zoomControl:!1,attributionControl:!1,scrollWheelZoom:!1,dragging:!1,doubleClickZoom:!1}).setView([l,s],13),M.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{maxZoom:19}).addTo(u),M.circleMarker([l,s],{color:"#fff",fillColor:"#1890ff",fillOpacity:1,radius:8,weight:3}).addTo(u)},S=()=>{r.value=!r.value,r.value&&setTimeout(()=>{u?u.invalidateSize():R()},400)},v=l=>{l&&l!==h.params.id&&L.replace(`/photo/${l}`).catch(()=>{})},V=l=>{var s;l.key==="ArrowLeft"&&f.value&&v(f.value.id),l.key==="ArrowRight"&&m.value&&v(m.value.id),l.key==="Escape"&&L.back(),(l.key==="i"||l.key==="I")&&S(),l.key===" "&&((s=o.value)==null?void 0:s.type)==="video"&&(l.preventDefault(),E())};K(()=>{Y.initData(),window.addEventListener("keydown",V),A(()=>{r.value&&R()})}),U(()=>window.removeEventListener("keydown",V));const D=i(null);let x=null;const H=()=>{var l;x&&(x.dispose(),x=null),D.value&&((l=o.value)==null?void 0:l.type)!=="video"&&(x=te(D.value,{maxZoom:5,minZoom:.5,bounds:!0,boundsPadding:.1,onTouch:()=>!1}))},$=i(null),B=i({}),N=()=>{const l=h.params.id,s=B.value[l];s&&$.value&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})};W(()=>h.params.id,l=>{l&&(w.value=!1,A(()=>{r.value&&R(),H(),N()}))},{immediate:!0});const O=()=>L.back(),Z=i(new Set),j=l=>Z.value.add(l),C=i(0),T=i(0),F=l=>{l.touches.length===1&&(C.value=l.changedTouches[0].screenX)},q=l=>{l.changedTouches.length===1&&(T.value=l.changedTouches[0].screenX,Math.abs(T.value-C.value)>50&&(T.value<C.value-50&&m.value&&v(m.value.id),T.value>C.value+50&&f.value&&v(f.value.id)))};return(l,s)=>{var k;return o.value?(d(),n("div",ie,[e("div",{class:"blur-bg",style:G({backgroundImage:`url(${o.value.url})`})},null,4),s[23]||(s[23]=e("div",{class:"blur-overlay"},null,-1)),e("div",ne,[e("div",{class:"preview-area",onTouchstartPassive:F,onTouchendPassive:q},[e("div",de,[e("button",{class:g(["icon-btn info-toggle",{active:r.value}]),onClick:S},[...s[2]||(s[2]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})],-1)])],2),e("button",{class:"icon-btn close-btn",onClick:O},[...s[3]||(s[3]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",ue,[f.value?(d(),n("button",{key:0,class:"nav-arrow left desktop-only",onClick:s[0]||(s[0]=z(a=>v(f.value.id),["stop"]))},"‚Äπ ")):p("",!0),o.value.type==="video"?(d(),n("div",{key:1,class:"panzoom-container video-container",onClick:z(E,["stop"])},[e("video",{ref_key:"videoRef",ref:y,src:o.value.url,poster:o.value.thumb,loop:"",muted:"",playsinline:"",class:"main-video"},null,8,re),e("div",{class:g(["live-badge",{active:w.value}])},[...s[4]||(s[4]=[e("div",{class:"live-icon"},[e("span")],-1),X(" LIVE ",-1)])],2)])):(d(),n("div",ve,[e("img",{ref_key:"mainImgRef",ref:D,src:o.value.url,alt:o.value.name,class:"main-img"},null,8,ce)])),m.value?(d(),n("button",{key:3,class:"nav-arrow right desktop-only",onClick:s[1]||(s[1]=z(a=>v(m.value.id),["stop"]))},"‚Ä∫ ")):p("",!0)]),e("div",fe,[e("div",{class:"filmstrip",ref_key:"filmstripRef",ref:$},[(d(!0),n(ee,null,se(c.value,a=>(d(),n("div",{key:a.id,class:g(["thumb-item",{active:a.id===o.value.id}]),ref_for:!0,ref:I=>{I&&(B.value[a.id]=I)},onClick:z(I=>v(a.id),["stop"])},[e("img",{src:a.url,loading:"lazy",class:g({visible:Z.value.has(a.id)}),onLoad:I=>j(a.id)},null,42,pe)],10,me))),128))],512)])],32),e("aside",{class:g(["sidebar",{"sidebar-closed":!r.value}])},[s[22]||(s[22]=e("div",{class:"mobile-handle"},null,-1)),(k=o.value.exif)!=null&&k.gps?(d(),n("div",he,[e("div",{ref_key:"mapContainer",ref:P,class:"map-view"},null,512),s[5]||(s[5]=e("div",{class:"map-overlay"},null,-1))])):p("",!0),e("div",ye,[e("div",ke,[s[10]||(s[10]=e("h3",{class:"block-title"},"Âü∫Êú¨‰ø°ÊÅØ",-1)),e("dl",be,[e("div",ge,[s[6]||(s[6]=e("dt",null,"Êñá‰ª∂Âêç",-1)),e("dd",{title:o.value.name},t(o.value.name),9,_e)]),e("div",we,[s[7]||(s[7]=e("dt",null,"Â∞∫ÂØ∏",-1)),e("dd",null,t(o.value.width)+" √ó "+t(o.value.height),1)]),e("div",xe,[s[8]||(s[8]=e("dt",null,"Â§ßÂ∞è",-1)),e("dd",null,t(o.value.size),1)]),e("div",Ce,[s[9]||(s[9]=e("dt",null,"Êó∂Èó¥",-1)),e("dd",null,t(le(oe)(o.value.date).format("YYYY/MM/DD HH:mm")),1)])])]),e("div",Te,[e("div",Ie,[s[11]||(s[11]=e("span",{class:"icon"},"üìÇ",-1)),X(" "+t(o.value.category),1)])]),o.value.exif?(d(),n("div",ze,[s[16]||(s[16]=e("h3",{class:"block-title"},"ÊãçÊëÑÂèÇÊï∞",-1)),e("div",Le,[e("div",Pe,[s[12]||(s[12]=e("span",{class:"p-label"},"ÁÑ¶Ë∑ù",-1)),e("span",Re,t(o.value.exif.focal),1)]),e("div",De,[s[13]||(s[13]=e("span",{class:"p-label"},"ÂÖâÂúà",-1)),e("span",Me,t(o.value.exif.fstop),1)]),e("div",Ee,[s[14]||(s[14]=e("span",{class:"p-label"},"Âø´Èó®",-1)),e("span",Se,t(o.value.exif.shutter),1)]),e("div",Ve,[s[15]||(s[15]=e("span",{class:"p-label"},"ISO",-1)),e("span",$e,t(o.value.exif.iso),1)])])])):p("",!0),o.value.exif?(d(),n("div",Be,[s[21]||(s[21]=e("h3",{class:"block-title"},"ËÆæÂ§á‰ø°ÊÅØ",-1)),e("dl",Ze,[e("div",Ae,[s[17]||(s[17]=e("dt",null,"Áõ∏Êú∫",-1)),e("dd",null,t(o.value.exif.make)+" "+t(o.value.exif.model),1)]),e("div",Xe,[s[18]||(s[18]=e("dt",null,"ÈïúÂ§¥",-1)),e("dd",{title:o.value.exif.lens},t(o.value.exif.lens),9,Ye)]),e("div",He,[s[19]||(s[19]=e("dt",null,"35mm",-1)),e("dd",null,t(o.value.exif.focal35),1)]),e("div",Ne,[s[20]||(s[20]=e("dt",null,"ËΩØ‰ª∂",-1)),e("dd",null,t(o.value.exif.software),1)])])])):p("",!0)])],2)])])):p("",!0)}}},Je=ae(Oe,[["__scopeId","data-v-8f81e4b5"]]);export{Je as default};
