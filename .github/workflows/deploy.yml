name: Auto Build & Deploy

# è§¦å‘æ¡ä»¶ï¼šå½“æœ‰ä»£ç æ¨é€åˆ° master æˆ– main åˆ†æ”¯æ—¶
on:
  push:
    branches:
      - master
      - main

# æƒé™è®¾ç½®ï¼šå…è®¸ Action ä¿®æ”¹ä½ çš„ä»“åº“ï¼ˆç”¨äºå‘å¸ƒï¼‰
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      # 2. å®‰è£… Node.js ç¯å¢ƒ
      - name: Setup Node.js âš™ï¸
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. å®‰è£…ä¾èµ–
      - name: Install Dependencies ğŸ”§
        run: npm install

      # 4. âœ¨ å…³é”®æ­¥éª¤ï¼šåœ¨äº‘ç«¯è¿è¡Œ scan.js ç”Ÿæˆæ•°æ® âœ¨
      # è¿™æ ·ä½ åªéœ€è¦ä¸Šä¼ å›¾ç‰‡ï¼Œä¸ç”¨è‡ªå·±åœ¨æœ¬åœ°ç”Ÿæˆ json
      - name: Run Photo Scan ğŸ“¸
        run: node enhance-photos.cjs

      - name: Run Photo enhance-photos.js
        run: node scan.js
      # 5. æ‰“åŒ… Vue é¡¹ç›®
      - name: Build Project ğŸ—ï¸
        run: npm run build

      # 6. è‡ªåŠ¨éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
      - name: Deploy to GitHub Pages ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist # éƒ¨ç½²æ‰“åŒ…ç”Ÿæˆçš„ dist æ–‡ä»¶å¤¹
